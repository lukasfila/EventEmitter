/*! @sedlak.r/mq@1.0.0 2023-01-16 */
globalThis.MQ&&console.warn("MQ already exists on globalThis, redefining"),globalThis.MQ={},MQ.Timer=function(e){"use strict";function t(e,t){this.timeout=e||30,this.timer=0,this.callback=t}return(e=t.prototype).run=function(){this.timer||(this.timer=setTimeout(function(e){this.cancel(),e()}.bind(this,this.callback),this.timeout))},e.cancel=function(){this.timer&&(clearTimeout(this.timer),this.timer=0)},e.version="1.0",t}(void MQ),MQ.Store=function(E,e){"use strict";function b(e,t){var n=e[t];return n||(e[t]=n=[]),n}function r(e,t,n,r){if(null!=n){var i,o,a,l=e,s=t,u=r,c=b(l,n),r=c.length;if(s===E.mqDefault)l[n]=[];else for(i=r-1;0<=i;i--)o=c[i],a=u&&o.context===s&&o.handler===u||!u&&o.context===s,(o.removed=a)&&c.splice(i,1)}else{var m,h,d,f,v,p=e,w=t,g=w===E.mqDefault;for(h in p)if(p.hasOwnProperty(h))for(m=(d=p[h]).length-1;0<=m;m--)v=(f=d[m]).context===w||g,(f.removed=v)&&d.splice(m,1)}}function i(e,t){this.context=e,this.handler=t,this.removed=!1}function t(){this.store={}}return(e=t.prototype).save=function(e,t,n){t=t.toLowerCase(),b(this.store,t).push(new i(e,n))},e.remove=function(e,t,n){t=t&&t.toLowerCase(),r(this.store,e,t,n)},e.evaluate=function(e,t){e=e.toLowerCase();for(var n,r=b(this.store,e),i=t,o=(r=r.slice(0)).length,a=0;a<o;a++)(n=r[a]).removed||n.handler.apply(n.context,i?[i]:[])},e.request=function(e,t){e=e.toLowerCase();var n=b(this.store,e),r=n.length;if(0===r)throw"EventEmitter: Can not make request on event that has not handler for '"+e+"'.";if(1<r)throw"EventEmitter: Can not make request on event that has more then one handler. Use EventEmitter.event('"+e+"') instead.";return void 0===(n=(r=n[0]).handler.apply(r.context,t?[t]:[]))&&console.warn("EventEmitter: Return from request '"+e+"' is empty! This is might not be valid state."),n},e.demand=function(e,t){e=e.toLowerCase();var n,r=b(this.store,e),i=r.length;if(1<i)throw"EventEmitter: Can not make demand on event that has more then one handler. Use EventEmitter.event('"+e+"') instead.";return n=i?(e=r[0]).handler.apply(e.context,t?[t]:[]):n},e.watching=function(e){return e=e.toLowerCase(),b(this.store,e).length},e.version="1.0",t}(MQ),MQ.Emitter=function(w,r){"use strict";var i,o=[],a=[],l=!1,s=!1,g=new w.Store;function u(e,t,n){var r,i,o,a;"tripleclick"===t?(r=e,a=o=0,(i=n).tripleDblClickHandler=function(e){document.body.addEventListener||i.tripleClickHandler(e||window.event)},i.tripleClickHandler=function(e){e=e||window.event,a>(new Date).getTime()-400?3===(o+=1)&&(o=0,i(e)):(o=1,a=0),a=a||(new Date).getTime()},u(r,"click",i.tripleClickHandler),u(r,"dblclick",i.tripleDblClickHandler)):(n.eventDoneRuntime=n.eventDoneRuntime||function(e){n(window.event||e)},e.addEventListener?e.addEventListener(t,n.eventDoneRuntime,!1):(e=e===window?document:e).attachEvent("on"+t,n.eventDoneRuntime),"mousewheel"===t&&u(e,"DOMMouseScroll",n.eventDoneRuntime))}function E(e,t,n){var r,i;"tripleclick"===t?(E(r=e,"click",(i=n).tripleClickHandler),E(r,"dblclick",i.tripleDblClickHandler),delete(r=i).tripleClickHandler,delete r.tripleDblClickHandler,c(i)):(e.removeEventListener?e.removeEventListener(t,n.eventDoneRuntime):(e=e===window?document:e).detachEvent("on"+t,n.eventDoneRuntime),"mousewheel"===t&&E(e,"DOMMouseScroll",n.eventDoneRuntime),c(n))}function c(e){delete e.element,delete e.type,delete e.context}function m(e,t,n,r){console&&l&&(0<=a.indexOf(t)||(console[e]?console[e]("EventEmitter: ("+(new Date).toLocaleTimeString()+") "+n,s?"":r):console.info("EventEmitter: ("+(new Date).toLocaleTimeString()+") "+n,s?"":r)))}function e(e){this.context=w.mqDefault,this.isStatic=e||!1}return w.mqDefault=window,(r=e.prototype).create=function(e){return(new w.Emitter).in(e)},r.event=function(e,t){return m("debug",e,"Event for '"+e+"' send with parameters ",t),g.evaluate(e,t),this},r.notify=function(e,t){var n={};return m("debug",e,"Notify for '"+e+"' send with parameters ",t),n.name=e,n.params=t,o.push(n),i||(i=new w.Timer(30,function(){for(var e=o.shift();e;)g.evaluate(e.name,e.params),e=o.shift();i.cancel(),i=null})).run(),i},r.request=function(e,t){var n=g.request(e,t);return m("debug",e,"Request for '"+e+"' return '"+n+"' for parameters ",t),n},r.demand=function(e,t){var n=g.demand(e,t);return m("debug",e,"Demand for '"+e+"' return '"+n+"' for parameters ",t),n},r.watching=function(e){var t=g.watching(e);return m("debug",e,"Watching count status for '"+e+"' return '"+t,[]),t},r.subscribe=function(e,t,n,r){var i,o,a=this.context,e=function(e,t,n,r){var i,o,a;if("string"==typeof e&&"function"==typeof t)return{element:null,name:e,handler:t,params:r||[]};if(i=e.nodeType&&1===e.nodeType,o=e===document,a=e===window,(i||a||o)&&"string"==typeof t&&"function"==typeof n)return{element:e,name:t,handler:n,params:r||[]};throw"EventEmitter: Incorrect parameters given into function subscribe() or unsubscribe()."}(e,t,n,r);function l(e){o.handler.apply(i,[[e].concat(o.params)])}return e.element?u(e.element,e.name,(i=a,t=(o=e).handler.handlers=o.handler.handlers||[],l.element=o.element,l.type=o.name,l.context=i,t.push(l),l)):g.save(this.context,e.name,e.handler),this},r.unsubscribe=function(e,t,n){t=t,n=n;var r,i,o=void 0===(e=e)||void 0===t?{element:null,name:null,handler:null}:"string"==typeof e&&"function"==typeof t?{element:null,name:e,handler:t}:(o=e.nodeType&&1===e.nodeType,r=e===document,i=e===window,(o||i||r)&&"string"==typeof t&&"function"==typeof n?{element:e,name:t,handler:n}:null);if(this.context!==w.mqDefault||o.name||o.handler||console.warn("EventEmitter: You are calling unsubscribe method without parameters. This is unbind all event through application!"),o.element){for(var a,l,s,u,c=this.context,m=o,h=[],d=m.name,f=m.element,v=m.handler.handlers||[],p=v.length-1;0<=p;p--)u=(s=v[p]).element,a=s.type,l=s.context,u===f&&d===a&&l===c?E(m.element,m.name,s):h.push(s);m.handler.handlers=h}else g.remove(this.context,o.name,o.handler);return this},r.interrupt=function(e,t,n){t&&((t=e).cancelBubble=!0,void 0!==t.stopPropagation)&&t.stopPropagation(),n&&((t=(t=e)||window.event).preventDefault&&t.preventDefault(),t.returnValue=!1)},r.in=function(e){if(this.isStatic)throw"EventEmitter: Can not change context on static method. Use EventEmitter.create() with right context.";return this.context=e,this},r.debugMode=function(e,t,n){a=t||[],l=e,s=n,r.getStore=e?function(){return g}:void 0,console.info("EventEmitter debug mode is set to "+(e?"on":"off")+" "+(n?"with simple mode":""))},r.version="1.0",e}(MQ),globalThis.EventEmitter&&console.warn(" EventEmitter already exists on globalThis, redefining"),globalThis.EventEmitter=new MQ.Emitter(!0);